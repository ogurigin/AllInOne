å‚è€ƒæ–‡ç« ï¼šğŸ‘‰ [**Three.js è¿›é˜¶ä¹‹æ—…ï¼šæ¨¡å‹å…‰æºç»“åˆç”Ÿæˆæ˜æš—å˜åŒ–çš„åˆ›æ„é¡µé¢-å…‰ä¸å½±ä¹‹è¯—](https://juejin.cn/post/7148969678642102286)**                  

åŠ¨ç”»æ–‡æ¡£ï¼šğŸ‘‰ [**TWEENæ–‡æ¡£**](https://tweenjs.github.io/tween.js/docs/user_guide_zh-CN.html)

---

å…¶ä»–ä¾æ—§ä¸èµ˜è¿°

æœ¬ä¾‹å­å¼€å¤´ä½¿ç”¨ TWEEN æ¥åŠ è½½loadingæ•ˆæœ + æ¨¡å‹ç§»åŠ¨åŠ¨ç”»

### ç›¸æœºç»„

```jsx
/*åˆ›å»ºä¸€ä¸ª ç»„ï¼Œå¹¶å°†ç›¸æœºåŠ å…¥ç»„*/
cameraGroup = new THREE.Group();
scene.add(cameraGroup);
camera = new THREE.PerspectiveCamera(75, topCanvas.clientWidth/topCanvas.clientHeight,0.1, 100);
cameraGroup.add(camera);
```

### ç¯å…‰

ä¸»è¦æ§åˆ¶ç‚¹å…‰æº æ¥åˆ›å»ºç§»åŠ¨çš„å…‰å½±

```jsx
// ç›´å°„å…‰
const directionLight = new THREE.DirectionalLight(0xffffff, .8);
directionLight.position.set(-100, 0, -80);
scene.add(directionLight);

// ç‚¹å…‰æº
fillLight = new THREE.PointLight(0x88ffee, 2.7, 4, 3);
fillLight.position.set(2, 3, 1.8);
scene.add(fillLight);
```

### å¼€å¤´çš„åŠ¨ç”»

`html` å†™äº†ä¸€ä¸ªid ä¸º`loadBox` åŠ è½½é¡µï¼Œæä¸€å˜´[**abductionå­—ä½“**](https://zh.fonts2u.com/abduction.%E5%AD%97%E4%BD%93) è¿˜è›®å¥½çœ‹çš„ 

ç„¶åé‡‡ç”¨`LoadingManager` åŠ è½½ç®¡ç†å™¨ ä¸ºå¯¼å…¥æ¨¡å‹æ·»åŠ åŠ¨ç”»æ•ˆæœ

```js
const manger = new THREE.LoadingManager();
let loadingEle  = document.getElementById('loadBox');
manger.onLoad  = ()=>{
	/* æƒ³ä¸‹å¹³ç§»å‡ºloading é¡µé¢*/
    const yPosition = {y:0};
    new TWEEN.Tween(yPosition)
        .to({y:100},1000)
        .easing(TWEEN.Easing.Quadratic.InOut)
        .start()
        .onUpdate(() => { 
            loadingEle.style.setProperty('transform', `translate(0, ${yPosition.y}%)`)}
        )
        .onComplete(function() { //è¿™é‡Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œthisè¯»å–ä¼šæœ‰é—®é¢˜
            isLoading.value = false; // éšè—loadingé¡µé¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤è¯¥å…ƒç´ ï¼Œè¿™è¾¹é€‰æ‹©éšè—
            TWEEN.remove(this)
        })
    
    /* ç§»åŠ¨ç›¸æœº åŠ¨ç”» 
			ç»™ä¸€ä¸ªæ¨¡å‹ä»è¿‘åˆ°è¿œçš„ åŠ¨ç”»*/
    new TWEEN.Tween(camera.position.set(0, 2, 1.2))
        .to({x:0,y:0.6,z:3.3},3500)
        .easing(TWEEN.Easing.Quadratic.InOut)
        .start()
        .onComplete(function (){
						cursor.animateOk = true;
            TWEEN.remove(this)
        })
 }
```

åŠ¨ç”» `manger`å†™å¥½åï¼Œéœ€è¦åœ¨åŠ è½½å™¨é‡è°ƒç”¨ï¼Œæ”¹ä¾‹å­çš„æ¨¡å‹æ˜¯  **blender** å‹ç¼©åçš„`glb`æ ¼å¼ï¼Œ**windows** è‡ªå¸¦çš„æ¨¡å‹ç®¡ç†å™¨å¯ä»¥å›æŠ¥é”™ï¼Œä½†ä½¿ç”¨`three`jsçš„ `DRACOLoader`åŠ è½½åä¼šæ­£å¸¸æ˜¾ç¤ºã€‚

> `vue`ä½¿ç”¨çš„æ—¶å€™éœ€è¦å°† `node_modules\three\examples\jsm\libs` ç›®å½•ä¸‹çš„ `draco`æ–‡ä»¶å¤¹ å¤åˆ¶åˆ°`public` æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œå¹¶æŒ‰ä¸‹é¢çš„ä»£ç é…ç½®ï¼Œæ‰èƒ½æ­£å¸¸åŠ è½½ã€‚  æ„Ÿè§‰ä¸æ˜¯å¾ˆå‹å¥½ï¼Œä¸ç¡®å®šæœ‰æ²¡æœ‰å…¶ä»–çš„å¼•å…¥æ–¹å¼ã€‚
> 

```jsx
const dracoLoader  = new DRACOLoader();
dracoLoader.setDecoderPath('/draco/');  //é…ç½®dracoæ–‡ä»¶å¤¹
dracoLoader.setDecoderConfig({ type: 'js' });
/* ä½¿ç”¨åŠ è½½ç®¡ç†å™¨  æ·»åŠ åŠ¨ç”» */
const loader = new GLTFLoader(manger); 
loader.setDRACOLoader(dracoLoader);
```

### å¯¼å…¥æ¨¡å‹

```jsx
loader.load('statue.glb', (gltf) => {
    const mesh = gltf.scene;
		const newMaterial = new THREE.MeshPhongMaterial({
	    shininess: 200,
	  });
	 // éå†æ¨¡å‹ä¸­çš„æ‰€æœ‰å¯¹è±¡
    mesh.traverse((obj) => {
        // å¦‚æœå¯¹è±¡æ˜¯ç½‘æ ¼å¯¹è±¡
        if (obj.isMesh) {
            // ä¿å­˜æ—§æè´¨
            const oldMaterial = obj.material;
            // åˆ›å»ºæ–°çš„æè´¨ å°†æè´¨åº”ç”¨åˆ°å¯¹è±¡ä¸Š,å¯ä»¥å°†æ¨¡å‹å˜æˆåå…‰æè´¨ï¼Œé…åˆç¯å…‰ä¼šæ¯”è¾ƒå¥½çœ‹
            obj.material = newMaterial;
				     /* æ¸…ç†æ—§æè´¨ï¼Œæ›¿æ¢å®Œæè´¨æ‰å°†æ¨¡å‹åŠ å…¥åœºæ™¯ï¼Œ
							çœŸçš„æœ‰éœ€è¦æ¸…ç†æ—§çš„æè´¨ å’Œ æ¸…ç†æ¸²æŸ“åˆ—è¡¨ä¹ˆ */
				    oldMaterial.dispose();
         }
         
    });
		mesh.position.set(0,-1.2,0)
    scene.add(mesh);
    // æ¸…ç†æ¸²æŸ“åˆ—è¡¨
    renderer.renderLists.dispose();
})
```

ğŸ‘‰ é—®äº†`ai` ğŸ¤£ , è¡¨ç¤ºåœ¨åŠ å…¥åœºæ™¯å‰æ›¿æ¢æ—§çš„æè´¨ï¼Œæ—§çš„æè´¨ä¾æ—§å¯èƒ½ä¼šå­˜åœ¨åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œæœ€å¥½çš„åšæ³•æ˜¯æ¸…ç†ã€‚**OKOK å­¦åˆ°äº†**

### å…‰å½±å˜åŒ–

æ¥ä¸‹æ¥å°±æ˜¯ è¿½è¸ªé¼ æ ‡çš„ç§»åŠ¨ï¼Œå¹¶æ”¹å˜ç›¸æœºå’Œ ç‚¹å…‰æºçš„ä½ç½®ï¼Œæ¥å®ç°å…‰å½±çš„æ•ˆæœ

é¼ æ ‡è·Ÿè¸ª

å­˜å‚¨é¼ æ ‡çš„ä½ç½®ä¿¡æ¯ï¼Œä»¥åŠæ˜¯å¦ç§»åŠ¨å‡ºè¯¥çª—å£ï¼Œå’Œè‡ªå®šä¹‰çš„å…‰æ ‡å…ƒç´  `animateOk`ä¸ºæ˜¯å¦å®Œæˆå¼€å¤´çš„åŠ¨ç”»

```jsx
const cursor = reactive( { x: 0, y: 0,hasCursor:true,ele:null,animateOk:false});

```

è®°å¾—åœ¨`init` æ–¹æ³•ä¸­ èµ‹å€¼`ele` 

```jsx
cursor.ele = document.querySelector('#cursor');
```

å¹¶åœ¨åœ¨`css`æ–‡ä»¶ä¸­ä½¿ç”¨`cursor: none;` éšè—åŸæœ‰é¼ æ ‡å…‰æ ‡
åœ¨å…ƒç´  `#cursor`ç”¨ `v-show="cursor.hasCursor"` æ“ä½œå…‰æ ‡çš„éšè—æ˜¾ç¤º

```jsx
document.addEventListener('mousemove', (event) => {
    event.preventDefault();
		//ç§»å…¥çš„æ—¶å€™ æ˜¾ç¤ºè‡ªå®šä¹‰å…‰æ ‡
		if(!cursor.hasCursor) cursor.hasCursor = true;
    cursor.x = event.clientX / window.innerWidth - .5;
    cursor.y = event.clientY / window.innerHeight - .5;
		// é¼ æ ‡ç§»åŠ¨æ—¶æ·»åŠ è™šæ‹Ÿå…‰æ ‡
    cursor.ele.style.cssText = `left: ${event.clientX}px; top: ${event.clientY}px;`;
}, false);
//ç§»å‡ºçš„æ—¶å€™ï¼Œéšè—è‡ªå®šä¹‰å…‰æ ‡
document.addEventListener("mouseout", () => {
      cursor.hasCursor = false;
 });
```

åœ¨ `animate` æ–¹æ³•ä¸­ï¼Œæ ¹æ® å­˜å‚¨çš„é¼ æ ‡ä½ç½®ï¼Œè¿›è¡Œç›¸æœºå’Œç¯å…‰çš„ç§»åŠ¨ã€‚

å¦‚æœä¸åˆ¤æ–­  `cursor.hasCursor`  å¯èƒ½ä¼šå‡ºç° å½“åˆ‡æ¢é¡µé¢å¾ˆé•¿æ—¶é—´å¹¶åˆ‡å›çš„æ—¶å€™ ï¼Œæ¨¡å‹å‡ºç°å¾ˆå°æˆ–è€…å¾ˆå¤§çš„æƒ…å†µï¼Œä½†å¦‚æœè¿‡æ—©ç§»å‡ºçª—å£ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¼€å¤´çš„åŠ¨ç”»å¡ä½ï¼Œ å¯ä»¥å†åŠ è½½çš„åŠ¨ç”»ä¸­åŠ ä¸ª å®Œæˆå±æ€§ï¼Œå¹¶åœ¨`animate`ä¸­è¿›è¡Œåˆ¤æ–­ 

```jsx
const clock = new THREE.Clock();
const animate = ()=>{
    const deltaTime = clock.getDelta();
    // ç‚¹å…‰æºä½ç½®
		/*å¦‚æœä¸åˆ¤æ–­å…‰æ ‡æ˜¯å¦ç§»å‡ºå…ƒç´ ï¼Œä¼šå‡ºç° åˆ‡æ¢é¡µé¢åï¼Œå†è¿”å› 
		å‘ç°æ¨¡å‹å¾ˆå°æˆ–è€…å¾ˆå¤§çš„æƒ…å†µï¼Œæˆ‘è¿™è¾¹åŠ äº†åˆ¤æ–­ */
    if(cursor.hasCursor || !cursor.animateOk){
        const parallaxY = cursor.y;
        const parallaxX = cursor.x
        fillLight.position.y -= (parallaxY * 9 + fillLight.position.y - 2) *deltaTime;
        fillLight.position.x += (parallaxX * 8 - fillLight.position.x) * 3 *deltaTime;
        // ç›¸æœºç»„ä½ç½®
        cameraGroup.position.z -= (parallaxY  / 3 + cameraGroup.position.z) * deltaTime;
        cameraGroup.position.x += (parallaxX / 3 - cameraGroup.position.x)  * 2 * deltaTime;

        renderer.render( scene, camera );
    }
    TWEEN.update();
    requestAnimationFrame(animate);
}
```